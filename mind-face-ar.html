<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-face.prod.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-face-aframe.prod.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.1.1/dist/aframe-extras.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const list = [
          "glasses1",
          "glasses2",
          "hat1",
          "hat2",
          "helmet",
          "helmet2",
        ];
        const visibles = [true, false, false, true, false, false];
        const setVisible = (button, entities, visible) => {
          if (visible) {
            button.classList.add("selected");
          } else {
            button.classList.remove("selected");
          }
          entities.forEach((entity) => {
            entity.setAttribute("visible", visible);
          });
        };
        list.forEach((item, index) => {
          const button = document.querySelector("#" + item);
          const entities = document.querySelectorAll("." + item + "-entity");
          setVisible(button, entities, visibles[index]);
          button.addEventListener("click", () => {
            visibles[index] = !visibles[index];
            setVisible(button, entities, visibles[index]);
          });
        });
      });
    </script>
    <script src="/flip.js" defer></script>
    <!--link type="text/css" rel="stylesheet" href="./style-flip.css" /-->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
      }
      .example-container {
        overflow: hidden;
        position: absolute;
        width: 100%;
        height: 100%;
      }
      .options-panel {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 2;
      }
      .options-panel img {
        border: solid 2px;
        width: 50px;
        height: 50px;
        object-fit: cover;
        cursor: pointer;
      }
      .options-panel img.selected {
        border-color: green;
      }
      .material-icons{
    position: absolute;
    font-size: 40px !important;
    color: white;
    width: 50px;
    height: 50px;
    justify-content: left;
    align-items: left;
    background-color: black;
    border-radius: 50%;
    padding-top: 7px;
    padding-left: 10px;
    margin-left: 70%;
    margin-top: 1%;
}
#flip-btn {
  position: absolute;
  bottom: 5%;
  right: 5%;
  padding: 10px 20px;
  
}
a-scene { 
  display: block; 
  width: 100%; 
}

.cameraControls {
    position: absolute;
    bottom: 70px;
    width: 100%;
    z-index: 9999;
    background: transparent;
    opacity: 0.7;
    padding: 0px;
}
         </style>
    <!--script type="text/javascript"> 
     
      var video;
      //ページを読み込み終わったら実行
      //顔認識の学習モデル
      var model;
      var faceMesh;

      window.onload = function() {
        //カメラ画像のサイズ設定(とりあえず640x480くらい)
        let constraints = { video: { width: 640, height: 480 } };
        //カメラデバイスの取得
        navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function(mediaStream) {
            //body内のid=videoの要素を取得
            video = document.getElementById("video");
            //リアルタイム映像をvideo要素に対応づける
            video.srcObject = mediaStream;
            //準備が整ったら再生
            video.onloadedmetadata = function(e) {
              video.playsInline = true;
              video.play();
              //three.jsによる描画準備
              InitRendering();
              CreateFaceObject();
              //顔認識を開始(このあと記述)
              StartTracking();
            };
          });
      };
      
      var VFaceMode = "user";
      window.onload = function() {

        let constraints = { video: {'facingMode': VFaceMode,
                                    'width': 640, 
                                    'height': 480} };
        
        //カメラデバイスの取得
        navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function(mediaStream) {
            //body内のid=videoの要素を取得
            video = document.getElementById("video");
            //リアルタイム映像をvideo要素に対応づける
            video.srcObject = mediaStream;
            //準備が整ったら再生
            video.onloadedmetadata = function(e) {
              video.playsInline = true;
              video.play();
              //three.jsによる描画準備
   //           InitRendering();
   //           CreateFaceObject();
              //顔認識を開始(このあと記述)
   //           StartTracking();
            };
          });
      };
      function camerachange() {
      if (VFaceMode == "user") { 
            VFaceMode = "environment"; }
           else {
            VFaceMode = "user";
        }
        alert(VFaceMode);
        window.onload();

       }
    </script-->
  </head>
  <body>
    <div class="example-container">
      <div class="options-panel">
        <img
          id="hat1"
          src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/dipper-cap-w.png?v=1657235824191"
        />
        <img
          id="hat2"
          src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/fiber-mask-w.png?v=1657380316244"
        />
        <img
          id="glasses1"
          src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/glasses-b-w.png?v=1657235824233"
        />
        <img
          id="glasses2"
          src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/examples/face-tracking/assets/glasses2/thumbnail.png"
        />
        <!--img
          id="earring"
          src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/blue-earing-w.png?v=1657338247696"
        /-->
        <img
          id="helmet"
          src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/t1-htelmet-w.png?v=1657342126600"
        />
        <img
          id="helmet2"
          src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/diver-helmet-w.png?v=1657338247750"
        />
      </div>
        <video id="video" style="position: absolute;"></video>
      <a-scene
        mindar-face
        embedded
        color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
      >
        <a-assets>
          <a-asset-item
            id="headModel"
            src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/examples/face-tracking/assets/sparkar/headOccluder.glb"
          ></a-asset-item>
          <!--a-asset-item
            id="glassesModel"
            src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/examples/face-tracking/assets/glasses/scene.gltf"
          ></a-asset-item-->
          <a-asset-item
            id="glassesModel"
            src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/glasses-b.glb?v=1657204915816"
          ></a-asset-item>
          <a-asset-item
            id="glassesModel2"
            src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/classic-glasses.glb?v=1657206461475"
          ></a-asset-item>
          <!--a-asset-item
            id="hatModel"
            src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/examples/face-tracking/assets/hat/scene.gltf"
          ></a-asset-item-->
          <a-asset-item
            id="hatModel"
            src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/dippen-cap.glb?v=1657205568784"
          ></a-asset-item>
          <!--a-asset-item
            id="hatModel2"
            src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/examples/face-tracking/assets/hat2/scene.gltf"
          ></a-asset-item-->
          <!--a-asset-item
            id="hatModel2"
            src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/hat.gltf?v=1657192863279"
          ></a-asset-item-->
          <a-asset-item
            id="hatModel2"
            src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/fiber-mask.glb?v=1657380318589"
          ></a-asset-item>
          <a-asset-item
            id="earringModel"
            src="https://cdn.glitch.global/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/blue-earing.glb?v=1657333040420"
          ></a-asset-item>
          <a-asset-item
            id="helmetModel"
            src="https://cdn.glitch.me/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/t1-helmet.glb?v=1657341801640"
          ></a-asset-item>
          <a-asset-item
            id="helmetModel2"
            src="https://cdn.glitch.me/3d3ecbaf-67a2-4d22-b8ec-ad23b8be5288/diver-helmet.glb?v=1657330875910"
          ></a-asset-item>
        </a-assets>
        <a-camera active="false" position="0 0 0"></a-camera>
        <!-- head occluder -->
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model
            mindar-face-occluder
            position="0 -0.3 0.15"
            rotation="0 0 0"
            scale="0.065 0.065 0.065"
            src="#headModel"
          ></a-gltf-model>
        </a-entity>
        <!--a-entity mindar-face-target="anchorIndex: 10">
          <a-gltf-model
            rotation="0 -0 0"
            position="0 1.0 -0.5"
            scale="0.35 0.35 0.35"
            src="#hatModel"
            class="hat1-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <!--a-entity mindar-face-target="anchorIndex: 10">
          <a-gltf-model
            rotation="0 -0 0"
            position="0.7 -0.15 -0.6"
            scale="0.65 0.65 0.65"
            src="#hatModel"
            class="hat1-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <a-entity mindar-face-target="anchorIndex: 10">
          <a-gltf-model
            rotation="0 -180 0"
            position="0 -0.35 -0.6"
            scale="0.00073 0.00073 0.00073"
            src="#hatModel"
            class="hat1-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity>
        <a-entity mindar-face-target="anchorIndex: 10">
          <a-gltf-model
            rotation="0 -180 0"
            position="0 -0.55 -0.5"
            scale="0.0075 0.0075 0.0075"
            src="#hatModel2"
            class="hat2-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity>
        <!--a-entity mindar-face-target="anchorIndex: 10">
          <a-gltf-model
            rotation="0 -0 0"
            position="0 -0.2 -0.5"
            scale="0.008 0.008 0.008"
            src="#hatModel2"
            class="hat2-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <!--a-entity mindar-face-target="anchorIndex: 10">
          <a-gltf-model
            rotation="0 -0 0"
            position="0 0.7 -0.65"
            scale="0.65 0.65 0.65"
            src="#hatModel2"
            class="hat2-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <!--a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model
            rotation="0 -0 0"
            position="0 0 0"
            scale="0.01 0.01 0.01"
            src="#glassesModel"
            class="glasses1-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model
            rotation="0 -0 0"
            position="0 -0.1 0"
            scale="0.8 0.8 0.8"
            src="#glassesModel"
            class="glasses1-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity>
        <!--a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model
            rotation="0 -90 0"
            position="0 -0.4 -0.1"
            scale="0.55 0.55 0.55"
            src="#glassesModel2"
            class="glasses2-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model
            rotation="0 -0 0"
            position="0 -0.25 -0"
            scale="0.22 0.22 0.22"
            src="#glassesModel2"
            class="glasses2-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity>
        <!--a-entity mindar-face-target="anchorIndex: 127">
          <a-gltf-model
            rotation="-0.1 -0 0"
            position="0 -0.3 -0.3"
            scale="0.05 0.05 0.05"
            src="#earringModel"
            class="earring-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <!--a-entity mindar-face-target="anchorIndex: 356">
          <a-gltf-model
            rotation="0.1 -0 0"
            position="0 -0.5 -0.3"
            scale="0.05 0.05 0.05"
            src="#earringModel"
            class="earring-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity-->
        <a-entity mindar-face-target="anchorIndex: 168">
          <a-gltf-model
            rotation="0 -0 0"
            position="0.2 -0 -0.7"
            scale="0.05 0.05 0.05"
            src="#helmetModel"
            class="helmet-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity>

        <a-entity mindar-face-target="anchorIndex: 170">
          <a-gltf-model
            rotation="0 -90 0"
            position="0.2 -0.6 -0.5"
            scale="0.009 0.009 0.009"
            src="#helmetModel2"
            class="helmet2-entity"
            visible="false"
          ></a-gltf-model>
        </a-entity>
      </a-scene>
    
       <div id="cameraControls" class="cameraControls">
       <a href="#" id="webcam-switch" title="WebCam Switch" onclick="camerachange()">
         <i class="material-icons">flip_camera_ios</i>
       </a>
    </div>

    <!--Videoタグ-->

    <canvas id="output" style="position: absolute;"></canvas>
    </div>

  </body>

</html>
